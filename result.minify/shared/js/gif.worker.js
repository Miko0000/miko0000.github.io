(function e(t,n,s){function o(i,r){if(!n[i]){if(!t[i]){var c,l,d=typeof require=="function"&&require;if(!r&&d)return d(i,!0);if(a)return a(i,!0);throw l=new Error("Cannot find module '"+i+"'"),l.code="MODULE_NOT_FOUND",l}c=n[i]={exports:{}},t[i][0].call(c.exports,function(e){var n=t[i][1][e];return o(n||e)},c,c.exports,e,t,n,s)}return n[i].exports}for(var a=typeof require=="function"&&require,i=0;i<s.length;i++)o(s[i]);return o})({1:[function(e,t){var i,a=e("./TypedNeuQuant.js"),r=e("./LZWEncoder.js");function o(){this.page=-1,this.pages=[],this.newPage()}o.pageSize=4096,o.charMap={};for(i=0;i<256;i++)o.charMap[i]=String.fromCharCode(i);o.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(o.pageSize),this.cursor=0},o.prototype.getData=function(){for(var e,n="",t=0;t<this.pages.length;t++)for(e=0;e<o.pageSize;e++)n+=o.charMap[this.pages[t][e]];return n},o.prototype.writeByte=function(e){this.cursor>=o.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=e},o.prototype.writeUTFBytes=function(e){for(var n=e.length,t=0;t<n;t++)this.writeByte(e.charCodeAt(t))},o.prototype.writeBytes=function(e,t,n){for(var o=n||e.length,s=t||0;s<o;s++)this.writeByte(e[s])};function s(e,t){this.width=~~e,this.height=~~t,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.neuQuant=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.dither=!1,this.globalPalette=!1,this.out=new o}s.prototype.setDelay=function(e){this.delay=Math.round(e/10)},s.prototype.setFrameRate=function(e){this.delay=Math.round(100/e)},s.prototype.setDispose=function(e){e>=0&&(this.dispose=e)},s.prototype.setRepeat=function(e){this.repeat=e},s.prototype.setTransparent=function(e){this.transparent=e},s.prototype.addFrame=function(e){this.image=e,this.colorTab=this.globalPalette&&this.globalPalette.slice?this.globalPalette:null,this.getImagePixels(),this.analyzePixels(),this.globalPalette===!0&&(this.globalPalette=this.colorTab),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),!this.firstFrame&&!this.globalPalette&&this.writePalette(),this.writePixels(),this.firstFrame=!1},s.prototype.finish=function(){this.out.writeByte(59)},s.prototype.setQuality=function(e){e<1&&(e=1),this.sample=e},s.prototype.setDither=function(e){e===!0&&(e="FloydSteinberg"),this.dither=e},s.prototype.setGlobalPalette=function(e){this.globalPalette=e},s.prototype.getGlobalPalette=function(){return this.globalPalette&&this.globalPalette.slice&&this.globalPalette.slice(0)||this.globalPalette},s.prototype.writeHeader=function(){this.out.writeUTFBytes("GIF89a")},s.prototype.analyzePixels=function(){this.colorTab||(this.neuQuant=new a(this.pixels,this.sample),this.neuQuant.buildColormap(),this.colorTab=this.neuQuant.getColormap()),this.dither?this.ditherPixels(this.dither.replace("-serpentine",""),this.dither.match(/-serpentine/)!==null):this.indexPixels(),this.pixels=null,this.colorDepth=8,this.palSize=7,this.transparent!==null&&(this.transIndex=this.findClosest(this.transparent,!0))},s.prototype.indexPixels=function(){var t,n,s,o=this.pixels.length/3;this.indexedPixels=new Uint8Array(o),t=0;for(n=0;n<o;n++)s=this.findClosestRGB(this.pixels[t++]&255,this.pixels[t++]&255,this.pixels[t++]&255),this.usedEntry[s]=!0,this.indexedPixels[n]=s},s.prototype.ditherPixels=function(e,t){if(g={FalseFloydSteinberg:[[3/8,1,0],[3/8,0,1],[2/8,1,1]],FloydSteinberg:[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]],Stucki:[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]],Atkinson:[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]]},!e||!g[e])throw"Unknown dithering kernel: "+e;var n,i,a,r,u,h,m,f,p,g,v,b,j,y,_,w,O,x,C,c=g[e],d=0,E=this.height,l=this.width,s=this.pixels,o=t?-1:1;this.indexedPixels=new Uint8Array(this.pixels.length/3);for(a=0;a<E;a++){t&&(o=o*-1);for(r=o==1?0:l-1,C=o==1?l:0;r!==C;r+=o){d=a*l+r,n=d*3,v=s[n],f=s[n+1],p=s[n+2],n=this.findClosestRGB(v,f,p),this.usedEntry[n]=!0,this.indexedPixels[d]=n,n*=3,b=this.colorTab[n],j=this.colorTab[n+1],y=this.colorTab[n+2],_=v-b,w=f-j,O=p-y;for(i=o==1?0:c.length-1,x=o==1?c.length:0;i!==x;i+=o)m=c[i][1],h=c[i][2],m+r>=0&&m+r<l&&h+a>=0&&h+a<E&&(u=c[i][0],n=d+m+h*l,n*=3,s[n]=Math.max(0,Math.min(255,s[n]+_*u)),s[n+1]=Math.max(0,Math.min(255,s[n+1]+w*u)),s[n+2]=Math.max(0,Math.min(255,s[n+2]+O*u)))}}},s.prototype.findClosest=function(e,t){return this.findClosestRGB((e&16711680)>>16,(e&65280)>>8,e&255,t)},s.prototype.findClosestRGB=function(e,t,n,s){if(this.colorTab===null)return-1;if(this.neuQuant&&!s)return this.neuQuant.lookupRGB(e,t,n);m=n|t<<8|e<<16,i=0,a=256*256*256,h=this.colorTab.length;for(var i,a,c,l,d,u,h,m,o=0,r=0;o<h;r++)c=e-(this.colorTab[o++]&255),l=t-(this.colorTab[o++]&255),d=n-(this.colorTab[o++]&255),u=c*c+l*l+d*d,(!s||this.usedEntry[r])&&u<a&&(a=u,i=r);return i},s.prototype.getImagePixels=function(){var e,t,n,s,o,i=this.width,a=this.height;this.pixels=new Uint8Array(i*a*3),t=this.image,e=0,n=0;for(s=0;s<a;s++)for(o=0;o<i;o++)this.pixels[n++]=t[e++],this.pixels[n++]=t[e++],this.pixels[n++]=t[e++],e++},s.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4);var e,t;this.transparent===null?(t=0,e=0):(t=1,e=2),this.dispose>=0&&(e=dispose&7),e<<=2,this.out.writeByte(0|e|0|t),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},s.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame||this.globalPalette?this.out.writeByte(0):this.out.writeByte(128|0|0|0|this.palSize)},s.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(128|112|0|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},s.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes("NETSCAPE2.0"),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},s.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);for(var t=3*256-this.colorTab.length,e=0;e<t;e++)this.out.writeByte(0)},s.prototype.writeShort=function(e){this.out.writeByte(e&255),this.out.writeByte(e>>8&255)},s.prototype.writePixels=function(){var e=new r(this.width,this.height,this.indexedPixels,this.colorDepth);e.encode(this.out)},s.prototype.stream=function(){return this.out},t.exports=s},{"./LZWEncoder.js":2,"./TypedNeuQuant.js":3}],2:[function(e,t){var i=-1,o=12,s=5003,a=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function r(e,t,n,r){var l,u,h,g,v,j,_=Math.max(2,r),E=new Uint8Array(256),d=new Int32Array(s),b=new Int32Array(s),c=0,p=0,m=!1;function w(e,t){E[l++]=e,l>=254&&x(t)}function k(e){O(s),p=u+2,m=!0,f(u,e)}function O(e){for(var t=0;t<e;++t)d[t]=-1}function A(e,t){v=e,m=!1,n_bits=v,g=y(n_bits),u=1<<e-1,j=u+1,p=u+2,l=0,a=C(),c=0;for(r=s;r<65536;r*=2)++c;c=8-c,_=s,O(_),f(u,t);outer_loop:for(var n,a,r,c,h,_,w;(h=C())!=i;){if(r=(h<<o)+a,n=h<<c^a,d[n]===r){a=b[n];continue}if(d[n]>=0){w=_-n,n===0&&(w=1);do if((n-=w)<0&&(n+=_),d[n]===r){a=b[n];continue outer_loop}while(d[n]>=0)}f(a,t),a=h,p<1<<o?(b[n]=p++,d[n]=r):k(t)}f(a,t),f(j,t)}function S(n){n.writeByte(_),remaining=e*t,curPixel=0,A(_+1,n),n.writeByte(0)}function x(e){l>0&&(e.writeByte(l),e.writeBytes(E,0,l),l=0)}function y(e){return(1<<e)-1}function C(){if(remaining===0)return i;--remaining;var e=n[curPixel++];return e&255}function f(e,t){for(h&=a[c],c>0?h|=e<<c:h=e,c+=n_bits;c>=8;)w(h&255,t),h>>=8,c-=8;if((p>g||m)&&(m?(g=y(n_bits=v),m=!1):(++n_bits,n_bits==o?g=1<<o:g=y(n_bits))),e==j){for(;c>0;)w(h&255,t),h>>=8,c-=8;x(t)}}this.encode=S}t.exports=r},{}],3:[function(e,t){var M,O=100,s=256,g=s-1,o=4,p=16,c=1<<p,l=10,F=1<<l,d=10,k=c>>d,E=c<<l-d,C=s>>3,r=6,x=1<<r,w=C*x,_=30,j=10,a=1<<j,b=8,v=1<<b,y=j+b,i=1<<y,f=499,m=491,h=487,u=503,A=3*u;function S(e,t){var n,b,j,y,x;function C(){n=[],b=new Int32Array(256),j=new Int32Array(s),y=new Int32Array(s),x=new Int32Array(s>>3);var e,t;for(e=0;e<s;e++)t=(e<<o+8)/s,n[e]=new Float64Array([t,t,t,0]),y[e]=c/s,j[e]=0}function S(){for(var e=0;e<s;e++)n[e][0]>>=o,n[e][1]>>=o,n[e][2]>>=o,n[e][3]=e}function M(e,t,s,o,i){n[t][0]-=e*(n[t][0]-s)/a,n[t][1]-=e*(n[t][1]-o)/a,n[t][2]-=e*(n[t][2]-i)/a}function F(e,t,o,a,r){for(var c,l,h=Math.abs(t-e),m=Math.min(t+e,s),d=t+1,u=t-1,f=1;d<m||u>h;)l=x[f++],d<m&&(c=n[d++],c[0]-=l*(c[0]-o)/i,c[1]-=l*(c[1]-a)/i,c[2]-=l*(c[2]-r)/i),u>h&&(c=n[u--],c[0]-=l*(c[0]-o)/i,c[1]-=l*(c[1]-a)/i,c[2]-=l*(c[2]-r)/i)}function T(e,t,i){var a,c,u,m,f,h=~(1<<31),g=h,r=-1,v=r;for(a=0;a<s;a++)c=n[a],u=Math.abs(c[0]-e)+Math.abs(c[1]-t)+Math.abs(c[2]-i),u<h&&(h=u,r=a),m=u-(j[a]>>p-o),m<g&&(g=m,v=a),f=y[a]>>d,y[a]-=f,j[a]+=f<<l;return y[r]+=k,j[r]-=E,v}function z(){var e,t,o,i,a,c,r=0,l=0;for(o=0;o<s;o++){i=n[o],c=o,a=i[1];for(e=o+1;e<s;e++)t=n[e],t[1]<a&&(c=e,a=t[1]);if(t=n[c],o!=c&&(e=t[0],t[0]=i[0],i[0]=e,e=t[1],t[1]=i[1],i[1]=e,e=t[2],t[2]=i[2],i[2]=e,e=t[3],t[3]=i[3],i[3]=e),a!=r){b[r]=l+o>>1;for(e=r+1;e<a;e++)b[e]=o;r=a,l=o}}b[r]=l+g>>1;for(e=r+1;e<256;e++)b[e]=g}function D(e,t,o){for(var i,a,r,c=1e3,u=-1,l=b[t],d=l-1;l<s||d>=0;)l<s&&(r=n[l],a=r[1]-t,a>=c?l=s:(l++,a<0&&(a=-a),i=r[0]-e,i<0&&(i=-i),a+=i,a<c&&(i=r[2]-o,i<0&&(i=-i),a+=i,a<c&&(c=a,u=r[3])))),d>=0&&(r=n[d],a=t-r[1],a>=c?d=-1:(d--,a<0&&(a=-a),i=r[0]-e,i<0&&(i=-i),a+=i,a<c&&(i=r[2]-o,i<0&&(i=-i),a+=i,a<c&&(c=a,u=r[3]))));return u}function N(){var s,i,l,d,g,j,y,c=e.length,k=30+(t-1)/3,E=c/(3*t),C=~~(E/O),p=a,b=w,n=b>>r;n<=1&&(n=0);for(s=0;s<n;s++)x[s]=p*((n*n-s*s)*v/(n*n));for(c<A?(t=1,d=3):c%f!==0?d=3*f:c%m!==0?d=3*m:c%h!==0?d=3*h:d=3*u,l=0,s=0;s<E;)if(g=(e[l]&255)<<o,j=(e[l+1]&255)<<o,y=(e[l+2]&255)<<o,i=T(g,j,y),M(p,i,g,j,y),n!==0&&F(n,i,g,j,y),l+=d,l>=c&&(l-=c),s++,C===0&&(C=1),s%C===0){p-=p/k,b-=b/_,n=b>>r,n<=1&&(n=0);for(i=0;i<n;i++)x[i]=p*((n*n-i*i)*v/(n*n))}}function L(){C(),N(),S(),z()}this.buildColormap=L;function R(){for(var o,i,a,e=[],r=[],t=0;t<s;t++)r[n[t][3]]=t;o=0;for(i=0;i<s;i++)a=r[i],e[o++]=n[a][0],e[o++]=n[a][1],e[o++]=n[a][2];return e}this.getColormap=R,this.lookupRGB=D}t.exports=S},{}],4:[function(e){var s=e("./GIFEncoder.js"),o=function(e){var n,o,i,t=new s(e.width,e.height);return e.index===0?t.writeHeader():t.firstFrame=!1,t.setTransparent(e.transparent),t.setRepeat(e.repeat),t.setDelay(e.delay),t.setQuality(e.quality),t.setDither(e.dither),t.setGlobalPalette(e.globalPalette),t.addFrame(e.data),e.last&&t.finish(),e.globalPalette===!0&&(e.globalPalette=t.getGlobalPalette()),n=t.stream(),e.data=n.pages,e.cursor=n.cursor,e.pageSize=n.constructor.pageSize,e.canTransfer?(i=function(){var t,n,s=e.data,i=[];for(t=0,n=s.length;t<n;t++)o=s[t],i.push(o.buffer);return i}(),self.postMessage(e,i)):self.postMessage(e)};self.onmessage=function(e){return o(e.data)}},{"./GIFEncoder.js":1}]},{},[4])